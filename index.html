<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Puzzle</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; padding: 24px; display: grid; place-items: center; }
    .wrap { max-width: 520px; width: 100%; text-align: center; }
    canvas { width: 100%; height: auto; border: 1px solid #ddd; border-radius: 12px; touch-action: manipulation; }
    button { margin-top: 12px; padding: 10px 14px; border-radius: 10px; border: 1px solid #ddd; background: #fff; cursor: pointer; }
  </style>
</head>
<body>
  <div class="wrap">
    <h2>Arma el puzzle ðŸ§©</h2>
    <canvas id="c" width="400" height="400"></canvas>
    <div><button id="shuffle">Mezclar</button></div>
    <p style="opacity:.7;font-size:14px">Tip: clic en una pieza junto al espacio vacÃ­o.</p>
  </div>

  <script>
    const N = 4; // 4x4
    const canvas = document.getElementById('c');
    const ctx = canvas.getContext('2d');
    const img = new Image();
    img.src = 'puzzle2.jpg';

    let tileSize = canvas.width / N;
    let board = []; // 0..15 (15 serÃ¡ vacÃ­o)
    const EMPTY = N*N - 1;

    function solvedBoard() {
      return Array.from({length: N*N}, (_, i) => i);
    }

    function findEmpty() {
      return board.indexOf(EMPTY);
    }

    function rc(i){ return [Math.floor(i / N), i % N]; }

    function neighbors(i){
      const [r,c] = rc(i);
      const nb = [];
      if (r>0) nb.push(i-N);
      if (r<N-1) nb.push(i+N);
      if (c>0) nb.push(i-1);
      if (c<N-1) nb.push(i+1);
      return nb;
    }

    function draw() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      for (let i=0;i<board.length;i++){
        const val = board[i];
        if (val === EMPTY) continue;

        const [dr, dc] = rc(i);
        const [sr, sc] = rc(val);

        ctx.drawImage(
          img,
          sc*tileSize, sr*tileSize, tileSize, tileSize,
          dc*tileSize, dr*tileSize, tileSize, tileSize
        );
      }
    }

    function move(i){
      const e = findEmpty();
      if (!neighbors(e).includes(i)) return false;
      [board[e], board[i]] = [board[i], board[e]];
      draw();
      return true;
    }

    function shuffle(steps=200){
      for (let k=0;k<steps;k++){
        const e = findEmpty();
        const nb = neighbors(e);
        const pick = nb[Math.floor(Math.random()*nb.length)];
        [board[e], board[pick]] = [board[pick], board[e]];
      }
      draw();
    }

    function onClick(evt){
      const rect = canvas.getBoundingClientRect();
      const x = (evt.clientX - rect.left) * (canvas.width / rect.width);
      const y = (evt.clientY - rect.top) * (canvas.height / rect.height);
      const c = Math.floor(x / tileSize);
      const r = Math.floor(y / tileSize);
      const i = r*N + c;
      if (move(i) && board.every((v,idx)=>v===idx)) {
        setTimeout(()=>alert('Â¡Lo lograste! ðŸŽ‰'), 50);
      }
    }

    canvas.addEventListener('click', onClick);
    document.getElementById('shuffle').addEventListener('click', ()=>shuffle());

    img.onload = () => {
      board = solvedBoard();
      shuffle();
    };
    img.onerror = () => {
      document.querySelector('p').textContent = 'No se pudo cargar puzzle.jpg. Revisa que el archivo se llame exactamente puzzle.jpg.';
    };
  </script>
</body>
</html>



